# Диаграмма компонентов системы учёта дефектов

## Обзор
Диаграмма показывает архитектуру системы: пользователи, клиентские приложения, микросервисы, базы данных и интеграции с внешними системами.

## Слой пользователей
Семь ролей взаимодействуют с двумя типами интерфейсов:
- **Web Client (SPA)** - веб-приложение для начальника цеха, бригадира, диспетчера, инженера QC, бухгалтерии и администратора
- **Mechanic Mobile (PWA/Tablet)** - мобильное приложение/планшет для ремонтников в цехе

## Слой API и реал-тайм
**API Gateway / BFF** - шлюз с Backend-for-Frontend паттерном. Агрегирует вызовы для каждой роли, проводит валидацию входных данных и rate limiting.

**Realtime Gateway (WebSocket/SSE)** - отправляет обновления в реальном времени (статус ремонтных мест, доступность рабочих) диспетчеру и ремонтникам через веб-сокеты или Server-Sent Events.

## Микросервисы (Domain Services)

**Identity & Access (IAM)** - управляет аутентификацией и авторизацией пользователей.

**Defect Service** - CRUD операции для дефектов, отображение места на схеме, каталог причин, политика серьёзности. Публикует события дефектов в message broker.

**Repair Service** - управляет назначениями работ, занятостью ремонтных мест, временными метками (начало/конец) и рабочими логами. Использует кэш для быстрого поиска доступных мест.

**Resources Service** - мастер-данные: ремонтные зоны, места, бригады, расписание смен, пропускная способность.

**Reporting & Analytics** - генерирует ежесменные и ежемесячные отчёты, записывает агрегаты в OLAP хранилище, экспортирует PDF/CSV.

**Notification Service** - отправляет оповещения через email, SMS и push-уведомления внешнему провайдеру.

**Integration Adapter** - синхронизирует данные с внешними системами (MES/ERP, HR для смен) и обрабатывает Change Data Capture (CDC) события.

## Хранилища данных

**Relational DB (PostgreSQL)** - основное хранилище для всех операционных данных (дефекты, ремонты, ресурсы, пользователи).

**Cache (Redis)** - быстрый доступ к актуальным данным: статус ремонтных мест, наличие свободных рабочих, сессии пользователей.

**Message Broker (Kafka/RabbitMQ)** - асинхронная доставка событий между сервисами для развязки OLTP и аналитических конвейеров.

**OLAP / Column Store (ClickHouse)** - специализированное хранилище для агрегации и анализа больших объёмов данных ремонтов и отчётности.

**Object Storage (S3/MinIO)** - хранение приложений к дефектам и ремонтам (фотографии, диаграммы, документы).

## Внешние системы

**MES / ERP** - интеграция с производственной системой и планированием ресурсов.

**HR / Shifts** - синхронизация данных о сотрудниках и расписании смен.

**Email / SMS Provider** - отправка уведомлений.

## Ключевые архитектурные решения

- **BFF паттерн** - отдельный шлюз для оптимизации каждого клиента (веб, мобиль)
- **Event-driven** - асинхронная передача событий через message broker для масштабируемости
- **Микросервисы** - разделение по доменам (дефекты, ремонты, ресурсы, отчёты) для независимого развертывания
- **Кэширование** - Redis для быстрого доступа к часто меняющимся данным (статус мест, свободные рабочие)
- **Аналитика отдельно** - OLAP хранилище и ETL от message broker для неблокирующей отчётности
- **Реал-тайм обновления** - WebSocket/SSE для диспетчера и мобильных рабочих
